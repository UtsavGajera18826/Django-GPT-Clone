<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GPT Clone</title>

<!-- jQuery & CSRF -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.0/dist/js.cookie.min.js"></script>

<!-- Markdown + Code Highlight -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

<style>
* {
    box-sizing: border-box;
    font-family: "Segoe UI", sans-serif;
}

body {
    margin: 0;
    background: #0f0f10;
    color: #e5e5e5;
    height: 100vh;
    display: flex;
    flex-direction: column;
}

.chat-header {
    padding: 16px;
    background: #1a1a1c;
    text-align: center;
    font-size: 20px;
    font-weight: 600;
    border-bottom: 1px solid #2a2a2d;
}

.chat-body {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 14px;
}

.message {
    max-width: 75%;
    padding: 14px 16px;
    border-radius: 14px;
    line-height: 1.7;
    font-size: 14px;
    position: relative;
}

.user {
    align-self: flex-end;
    background: #0d6efd;
    color: white;
    border-bottom-right-radius: 4px;
}

.bot {
    align-self: flex-start;
    background: #1f1f22;
    color: #dcdcdc;
    border-bottom-left-radius: 4px;
}

.bot strong {
    color: #4da3ff;
}

pre {
    background: #0d1117;
    padding: 12px;
    border-radius: 10px;
    overflow-x: auto;
}

code {
    font-family: Consolas, monospace;
    font-size: 13px;
}

.copy-btn {
    position: absolute;
    top: 8px;
    right: 10px;
    background: transparent;
    border: none;
    color: #aaa;
    font-size: 12px;
    cursor: pointer;
}

.copy-btn:hover {
    color: #fff;
}

.typing {
    font-style: italic;
    color: #aaa;
}

.chat-footer {
    padding: 14px;
    background: #1a1a1c;
    border-top: 1px solid #2a2a2d;
    display: flex;
    gap: 10px;
}

textarea {
    flex: 1;
    resize: none;
    background: #121214;
    color: #e5e5e5;
    border: 1px solid #2a2a2d;
    border-radius: 10px;
    padding: 12px;
    font-size: 14px;
}

textarea::placeholder {
    color: #888;
}

button.send-btn {
    background: #0d6efd;
    border: none;
    border-radius: 10px;
    padding: 0 20px;
    color: white;
    cursor: pointer;
}

button.send-btn:hover {
    background: #0b5ed7;
}

::-webkit-scrollbar {
    width: 6px;
}
::-webkit-scrollbar-thumb {
    background: #333;
    border-radius: 3px;
}
</style>

<script>
$(document).ready(function () {

    function scrollBottom() {
        $('.chat-body').scrollTop($('.chat-body')[0].scrollHeight);
    }

    function copyText(btn) {
        const text = $(btn).siblings('.bot-text').text();
        navigator.clipboard.writeText(text);
        btn.innerText = "Copied!";
        setTimeout(() => btn.innerText = "Copy", 1200);
    }
    window.copyText = copyText;

    $('form').on('submit', function (e) {
        e.preventDefault();

        let csrftoken = Cookies.get('csrftoken');
        $.ajaxSetup({
            headers: { 'X-CSRFToken': csrftoken }
        });

        let prompt = $('#prompt').val().trim();
        if (!prompt) return;

        $('.chat-body').append(`
            <div class="message user">
                <strong>You:</strong><br>${prompt}
            </div>
        `);

        $('#prompt').val('');
        scrollBottom();

        let typing = $(`
            <div class="message bot typing" id="typing">
                <strong>GPT:</strong><br>typing...
            </div>
        `);
        $('.chat-body').append(typing);
        scrollBottom();

        $.ajax({
            url: '/',
            type: 'POST',
            data: { prompt: prompt },
            success: function (data) {
                $('#typing').remove();

                // Markdown rendering (bullets, bold, headings)
                let html = marked.parse(data.response);

                let botMsg = $(`
                    <div class="message bot">
                        <button class="copy-btn" onclick="copyText(this)">Copy</button>
                        <strong>GPT:</strong>
                        <div class="bot-text">${html}</div>
                    </div>
                `);

                $('.chat-body').append(botMsg);

                // Syntax highlighting
                botMsg.find('pre code').each(function () {
                    hljs.highlightElement(this);
                });

                scrollBottom();
            }
        });
    });
});
</script>
</head>

<body>

<div class="chat-header">âš¡ GPT Clone</div>

<div class="chat-body"></div>

<form class="chat-footer" method="post">
    {% csrf_token %}
    <textarea id="prompt" rows="2" placeholder="Type your message..."></textarea>
    <button class="send-btn" type="submit">Send</button>
</form>

</body>
</html>
